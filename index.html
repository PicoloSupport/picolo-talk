<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Talk to Picolo</title>
  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      display: grid;
      place-items: center;
      padding: 0 16px;
    }
    button {
      cursor: pointer;
      padding: 12px 22px;
      border-radius: 9999px;
      background: #fff;
      color: #111;
      font-weight: 600;
      font-size: 16px;
      line-height: 1;
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    }
  </style>
</head>
<body>

  <button id="talk">Press to Talk</button>

  <!-- Load the Vapi Web SDK (version pinned) -->
<script src="https://esm.sh/@vapi-ai/web@2.4.0/dist/vapi.js"></script>

  <!-- Wire up your button -->
  <script>
    // Your keys
    const PUBLIC_KEY   = "fc5f6fc4-d5da-4bfe-8b02-6035430c1d92";
    const ASSISTANT_ID = "567a070a-9e4a-478c-9218-ab2e16bce29b";

    // Wait until SDK is present (just in case)
    (function ready(fn){
      if (window.Vapi) return fn();
      const iv = setInterval(() => { if (window.Vapi){ clearInterval(iv); fn(); } }, 50);
      setTimeout(() => clearInterval(iv), 5000);
    })(function attach(){
      const vapi = new Vapi(PUBLIC_KEY);
      const btn  = document.getElementById("talk");
      if (!btn) return;

      let inCall = false;
      const set = t => btn.textContent = t;

      btn.onclick = async () => {
        btn.disabled = true;
        try {
          if (!inCall) {
            set("Connecting...");
            await vapi.start(ASSISTANT_ID);
            inCall = true; set("End");
          } else {
            await vapi.stop();
            inCall = false; set("Press to Talk");
          }
        } catch (e) {
          console.error(e);
          inCall = false; set("Press to Talk");
        } finally {
          btn.disabled = false;
        }
      };

      vapi.on("call-start", () => { inCall = true;  set("End"); });
      vapi.on("call-end",   () => { inCall = false; set("Press to Talk"); });
      vapi.on("error",      () => { inCall = false; set("Press to Talk"); });
    });
  </script>
</body>
</html>
