<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Talk to Picolo</title>
  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      display: grid;
      place-items: center;
      padding: 0 16px;
    }
    button {
      cursor: pointer;
      padding: 12px 22px;
      border-radius: 9999px;
      background: #fff;
      color: #111;
      font-weight: 600;
      font-size: 16px;
      line-height: 1;
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    }
  </style>
</head>
<body>

  <button id="talk">Press to Talk</button>

  <!-- Robust loader: tries multiple CDN paths, then wires the button -->
  <script>
    (async () => {
      // 1) Load the Vapi Web SDK (try a few likely paths)
      const cdnCandidates = [
        "https://cdn.jsdelivr.net/npm/@vapi-ai/web@2.4.0/dist/vapi.js",
        "https://cdn.jsdelivr.net/npm/@vapi-ai/web/dist/vapi.js",
        "https://unpkg.com/@vapi-ai/web@2.4.0/dist/vapi.js",
        "https://unpkg.com/@vapi-ai/web/dist/vapi.js",
        "https://unpkg.com/@vapi-ai/web/dist/index.min.js",
        "https://cdn.jsdelivr.net/npm/@vapi-ai/web/dist/index.min.js"
      ];

      function loadScript(src) {
        return new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = src;
          s.onload = () => resolve(src);
          s.onerror = () => reject(new Error("Failed: " + src));
          document.head.appendChild(s);
        });
      }

      let loadedFrom = null;
      for (const url of cdnCandidates) {
        try { loadedFrom = await loadScript(url); break; }
        catch (_) {}
      }
      if (!loadedFrom || !window.Vapi) {
        console.error("Could not load Vapi Web SDK from any CDN.");
        document.getElementById("talk").disabled = true;
        document.getElementById("talk").textContent = "Voice SDK failed to load";
        return;
      }

      // 2) Your keys
      const PUBLIC_KEY   = "fc5f6fc4-d5da-4bfe-8b02-6035430c1d92";
      const ASSISTANT_ID = "567a070a-9e4a-478c-9218-ab2e16bce29b";

      // 3) Wire the button
      const vapi = new window.Vapi(PUBLIC_KEY);
      const btn  = document.getElementById("talk");
      let inCall = false;
      const setText = (t) => btn.textContent = t;

      btn.onclick = async () => {
        btn.disabled = true;
        try {
          if (!inCall) {
            setText("Connecting...");
            await vapi.start(ASSISTANT_ID);
            inCall = true; setText("End");
          } else {
            await vapi.stop();
            inCall = false; setText("Press to Talk");
          }
        } catch (e) {
          console.error(e);
          inCall = false; setText("Press to Talk");
        } finally {
          btn.disabled = false;
        }
      };

      vapi.on("call-start", () => { inCall = true;  setText("End"); });
      vapi.on("call-end",   () => { inCall = false; setText("Press to Talk"); });
      vapi.on("error",      () => { inCall = false; setText("Press to Talk"); });
    })();
  </script>
</body>
</html>
